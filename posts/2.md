---
title: Static Site Generator - Adding Watch Mode - Stage 2
date: 2025-02-17
description: Adding development-friendly file watching to our static site generator
---

In this second stage of development, we've added file watching capabilities to our static site generator. This makes the development process much smoother by automatically rebuilding pages when their source files change.

## New Feature: Watch Mode

The generator now supports a watch mode that:
- Monitors the `posts/` directory for changes
- Automatically rebuilds markdown files when they're modified
- Provides immediate feedback in the console

### Running in Watch Mode

```bash
deno run --allow-read --allow-write generator.js --watch
```

## Implementation

Here's the new watch functionality we've added:

```js
// Watch for changes
async function watch(postsDir = './posts', outputDir = './blog') {
  console.log('Watching for changes...');
  
  const watcher = Deno.watchFs(postsDir);
  
  for await (const event of watcher) {
    if (event.kind === 'modify' || event.kind === 'create') {
      for (const path of event.paths) {
        if (path.endsWith('.md')) {
          await processFile(path, outputDir);
        }
      }
    }
  }
}


// CLI
if (import.meta.main) {
  const args = Deno.args;
  if (args.includes('--watch')) {
    await watch();
  } else {
    await build();
  }
}
```

### How It Works

1. The `watch` function uses Deno's built-in [`Deno.watchFs`](https://docs.deno.com/api/deno/~/Deno.watchFs) API to monitor the posts directory
2. When a file change is detected, it checks if:
   - The event is a file modification or creation
   - The file is a markdown file (ends with .md)
3. If both conditions are met, it processes the changed file
4. The processing uses the same `processFile` function as the regular build

### CLI Enhancement

We've added command-line argument parsing to support two modes:
- Default mode: Single build (no arguments)
- Watch mode: Continuous watching (--watch flag)

## Example Workflow

1. Start the generator in watch mode:
   ```bash
   deno run --allow-read --allow-write generator.js --watch
   ```

2. Edit your markdown files:
   ```markdown
   ---
   title: My Post
   date: 2025-02-17
   ---

   # Hello World
   
   Making changes to this file will trigger an automatic rebuild...
   ```

3. Save the file and see the console output:
   ```
   Watching for changes...
   Generated my-post.html
   ```

## Technical Details

### File System Events

The watcher responds to these events:
- `create`: When a new file is added
- `modify`: When an existing file is changed

### Performance Considerations

- The watcher is efficient, using Deno's native file system events
- Only processes .md files, ignoring other file types
- Processes one file at a time in the order changes are detected

## Next Steps

With watch mode implemented, our next planned features are:
- Index page generation
- Tag support
- Syntax highlighting
- Cache invalidation for faster builds

## Requirements

The requirements remain the same as Stage 1, with no additional dependencies:
- Deno 1.41 or later
- Write permissions for the output directory
- Read permissions for the posts directory
- npm package: marked

The addition of watch mode makes development much more efficient, especially when making frequent changes to your content.