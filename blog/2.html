
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Static Site Generator - Adding Watch Mode</title>
    <style>
      body {
        max-width: 800px;
        margin: 0 auto;
        padding: 1rem;
        font-family: system-ui, sans-serif;
        line-height: 1.5;
      }
      pre {
        padding: 1rem;
        background: #f6f8fa;
        border-radius: 4px;
        overflow-x: auto;
      }
      a {
        color: #0066cc;
        text-decoration: none;
      }
      a:hover {
        text-decoration: underline;
      }
    </style>
</head>
<body>
    <article>
        <h1>Static Site Generator - Adding Watch Mode</h1>
        <time>2/16/2025</time>
        <p>In this second stage of development, we&#39;ve added file watching capabilities to our static site generator. This makes the development process much smoother by automatically rebuilding pages when their source files change.</p>
<h2>New Feature: Watch Mode</h2>
<p>The generator now supports a watch mode that:</p>
<ul>
<li>Monitors the <code>posts/</code> directory for changes</li>
<li>Automatically rebuilds markdown files when they&#39;re modified</li>
<li>Provides immediate feedback in the console</li>
</ul>
<h3>Running in Watch Mode</h3>
<pre><code class="language-bash">deno run --allow-read --allow-write generator.js --watch
</code></pre>
<h2>Implementation</h2>
<p>Here&#39;s the new watch functionality we&#39;ve added:</p>
<pre><code class="language-js">// Watch for changes
async function watch(postsDir = &#39;./posts&#39;, outputDir = &#39;./blog&#39;) {
  console.log(&#39;Watching for changes...&#39;);
  
  const watcher = Deno.watchFs(postsDir);
  
  for await (const event of watcher) {
    if (event.kind === &#39;modify&#39; || event.kind === &#39;create&#39;) {
      for (const path of event.paths) {
        if (path.endsWith(&#39;.md&#39;)) {
          await processFile(path, outputDir);
        }
      }
    }
  }
}


// CLI
if (import.meta.main) {
  const args = Deno.args;
  if (args.includes(&#39;--watch&#39;)) {
    await watch();
  } else {
    await build();
  }
}
</code></pre>
<h3>How It Works</h3>
<ol>
<li>The <code>watch</code> function uses Deno&#39;s built-in <a href="https://docs.deno.com/api/deno/~/Deno.watchFs"><code>Deno.watchFs</code></a> API to monitor the posts directory</li>
<li>When a file change is detected, it checks if:<ul>
<li>The event is a file modification or creation</li>
<li>The file is a markdown file (ends with .md)</li>
</ul>
</li>
<li>If both conditions are met, it processes the changed file</li>
<li>The processing uses the same <code>processFile</code> function as the regular build</li>
</ol>
<h3>CLI Enhancement</h3>
<p>We&#39;ve added command-line argument parsing to support two modes:</p>
<ul>
<li>Default mode: Single build (no arguments)</li>
<li>Watch mode: Continuous watching (--watch flag)</li>
</ul>
<h2>Example Workflow</h2>
<ol>
<li><p>Start the generator in watch mode:</p>
<pre><code class="language-bash">deno run --allow-read --allow-write generator.js --watch
</code></pre>
</li>
<li><p>Edit your markdown files:</p>
<pre><code class="language-markdown">---
title: My Post
date: 2025-02-17
---

# Hello World

Making changes to this file will trigger an automatic rebuild...
</code></pre>
</li>
<li><p>Save the file and see the console output:</p>
<pre><code>Watching for changes...
Generated my-post.html
</code></pre>
</li>
</ol>
<h2>Technical Details</h2>
<h3>File System Events</h3>
<p>The watcher responds to these events:</p>
<ul>
<li><code>create</code>: When a new file is added</li>
<li><code>modify</code>: When an existing file is changed</li>
</ul>
<h3>Performance Considerations</h3>
<ul>
<li>The watcher is efficient, using Deno&#39;s native file system events</li>
<li>Only processes .md files, ignoring other file types</li>
<li>Processes one file at a time in the order changes are detected</li>
</ul>
<h2>Next Steps</h2>
<p>With watch mode implemented, our next planned features are:</p>
<ul>
<li>Index page generation</li>
<li>Tag support</li>
<li>Syntax highlighting</li>
<li>Cache invalidation for faster builds</li>
</ul>
<h2>Requirements</h2>
<p>The requirements remain the same as Stage 1, with no additional dependencies:</p>
<ul>
<li>Deno 1.41 or later</li>
<li>Write permissions for the output directory</li>
<li>Read permissions for the posts directory</li>
<li>npm package: marked</li>
</ul>
<p>The addition of watch mode makes development much more efficient, especially when making frequent changes to your content.</p>

    </article>
</body>
</html>
  